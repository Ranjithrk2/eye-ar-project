<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AR Eye Voice</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>

<style>
body{
    margin:0;
    overflow:hidden;
}

#info{
    position:absolute;
    bottom:20px;
    width:100%;
    text-align:center;
    color:white;
    background:rgba(0,0,0,0.6);
    padding:10px;
    font-family:Arial;
}
</style>
</head>

<body>

<div id="info">
ðŸ‘‰ Tap once â†’ Scan HIRO marker
</div>

<a-scene
embedded
vr-mode-ui="enabled:false"
renderer="logarithmicDepthBuffer:true;"
arjs="sourceType: webcam; debugUIEnabled: false;"
>

<a-assets>
    <a-asset-item id="eyeModel" src="models/eye.glb"></a-asset-item>
</a-assets>

<a-marker preset="hiro" id="marker">

    <a-entity id="modelContainer" scale="1 1 1">

        <a-entity
            gltf-model="#eyeModel"
            position="0 0 0">
        </a-entity>

    </a-entity>

</a-marker>

<a-entity camera></a-entity>

</a-scene>

<script>

// ================= VOICE SYSTEM =================

let audioUnlocked = false;

// Unlock speech on first tap (mobile requirement)
document.body.addEventListener("click", () => {
    audioUnlocked = true;
}, { once:true });


function speakEyeInfo(){

    if(!audioUnlocked) return;

    const englishText =
    "The human eye is an important sensory organ. It helps us to see light, colors, shapes, and movement. The main parts of the eye include the cornea, iris, pupil, lens, and retina.";

    const kannadaText =
    "à²®à²¾à²¨à²µ à²•à²£à³à²£à³ à²’à²‚à²¦à³ à²ªà³à²°à²®à³à²– à²‡à²‚à²¦à³à²°à²¿à²¯ à²…à²‚à²—à²µà²¾à²—à²¿à²¦à³†. à²‡à²¦à³ à²¬à³†à²³à²•à³, à²¬à²£à³à²£à²—à²³à³, à²†à²•à²¾à²°à²—à²³à³ à²®à²¤à³à²¤à³ à²šà²²à²¨à²µà²²à²¨à²µà²¨à³à²¨à³ à²¨à³‹à²¡à²²à³ à²¸à²¹à²¾à²¯ à²®à²¾à²¡à³à²¤à³à²¤à²¦à³†. à²•à²£à³à²£à²¿à²¨ à²®à³à²–à³à²¯ à²­à²¾à²—à²—à²³à³ à²•à²¾à²°à³à²¨à²¿à²¯à²¾, à²à²°à²¿à²¸à³, à²ªà³à²¯à³à²ªà²¿à²²à³, à²²à³†à²¨à³à²¸à³ à²®à²¤à³à²¤à³ à²°à³†à²Ÿà²¿à²¨à²¾ à²†à²—à²¿à²µà³†.";

    // English speech
    const english = new SpeechSynthesisUtterance(englishText);
    english.lang = "en-US";
    english.rate = 0.9;

    // Kannada speech
    const kannada = new SpeechSynthesisUtterance(kannadaText);
    kannada.lang = "kn-IN";
    kannada.rate = 0.9;

    // Speak English then Kannada
    english.onend = () => {
        speechSynthesis.speak(kannada);
    };

    speechSynthesis.speak(english);
}


// ================= MARKER EVENT =================

window.addEventListener("load", ()=>{

    const marker = document.querySelector("#marker");

    marker.addEventListener("markerFound", () => {
        speakEyeInfo();
    });

});


// ================= TOUCH ROTATE + ZOOM =================

window.addEventListener("load", () => {

const container = document.getElementById("modelContainer");

let isDragging = false;
let previousX = 0;
let previousY = 0;
let scale = 1;
let startDistance = null;

function getDistance(touches){
    let dx = touches[0].clientX - touches[1].clientX;
    let dy = touches[0].clientY - touches[1].clientY;
    return Math.sqrt(dx*dx + dy*dy);
}

document.addEventListener("touchstart", e=>{
    if(e.touches.length === 1){
        isDragging = true;
        previousX = e.touches[0].clientX;
        previousY = e.touches[0].clientY;
    }

    if(e.touches.length === 2){
        startDistance = getDistance(e.touches);
    }
});

document.addEventListener("touchmove", e=>{

    if(!container) return;

    if(isDragging && e.touches.length === 1){

        let deltaX = e.touches[0].clientX - previousX;
        let deltaY = e.touches[0].clientY - previousY;

        let rotation = container.getAttribute("rotation") || {x:0,y:0,z:0};

        rotation.y += deltaX * 0.5;
        rotation.x += deltaY * 0.5;

        container.setAttribute("rotation", rotation);

        previousX = e.touches[0].clientX;
        previousY = e.touches[0].clientY;
    }

    if(e.touches.length === 2){

        let newDistance = getDistance(e.touches);

        if(startDistance){

            let diff = newDistance - startDistance;

            scale += diff * 0.005;
            scale = Math.min(Math.max(scale, 0.5), 3);

            container.setAttribute("scale",
                `${scale} ${scale} ${scale}`);
        }

        startDistance = newDistance;
    }

});

document.addEventListener("touchend", ()=>{
    isDragging = false;
    startDistance = null;
});

});

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Human Eye AR Voice</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>

<style>
body{
    margin:0;
    overflow:hidden;
    font-family: Arial;
}

#info{
    position:absolute;
    bottom:20px;
    width:100%;
    text-align:center;
    color:white;
    background:rgba(0,0,0,0.6);
    padding:10px;
}

.controls{
    position:absolute;
    top:10px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:10px;
}

button{
    padding:10px 15px;
    border:none;
    border-radius:8px;
    background:#00aaff;
    color:white;
    font-size:14px;
}
</style>
</head>

<body>

<div class="controls">
    <button onclick="playEnglish()">English Voice</button>
    <button onclick="playKannada()">Kannada Voice</button>
</div>

<div id="info">
ðŸ“± Tap screen once â†’ Point camera at HIRO marker
</div>

<!-- AUDIO FILES -->
<audio id="audioEN" src="audio/eye_en.mp3"></audio>
<audio id="audioKN" src="audio/eye_kn.mp3"></audio>

<a-scene
embedded
vr-mode-ui="enabled:false"
renderer="logarithmicDepthBuffer:true;"
arjs="sourceType: webcam; debugUIEnabled: false;"
>

<a-assets>
    <a-asset-item id="eyeModel" src="models/eye.glb"></a-asset-item>
</a-assets>

<a-marker preset="hiro" id="marker">

    <a-entity id="modelContainer"
              scale="1 1 1"
              rotation="0 0 0">

        <a-entity
            id="eye"
            gltf-model="#eyeModel"
            position="0 0 0">
        </a-entity>

    </a-entity>

</a-marker>

<a-entity camera></a-entity>

</a-scene>

<script>

// ================= AUDIO =================

let audioUnlocked = false;

const audioEN = document.getElementById("audioEN");
const audioKN = document.getElementById("audioKN");

function unlockAudio(){
    audioUnlocked = true;
}

// unlock on first tap
document.body.addEventListener("click", unlockAudio, { once:true });

function playEnglish(){
    if(!audioUnlocked) return;
    audioKN.pause();
    audioEN.currentTime = 0;
    audioEN.play();
}

function playKannada(){
    if(!audioUnlocked) return;
    audioEN.pause();
    audioKN.currentTime = 0;
    audioKN.play();
}


// Auto play English when marker detected
const marker = document.querySelector("#marker");

marker.addEventListener("markerFound", () => {
    if(audioUnlocked){
        playEnglish();
    }
});


// ================= TOUCH CONTROLS =================

window.addEventListener("load", () => {

const container = document.getElementById("modelContainer");

let isDragging = false;
let previousX = 0;
let previousY = 0;
let scale = 1;
let startDistance = null;

function getDistance(touches){
    let dx = touches[0].clientX - touches[1].clientX;
    let dy = touches[0].clientY - touches[1].clientY;
    return Math.sqrt(dx*dx + dy*dy);
}

document.addEventListener("touchstart", e=>{
    if(e.touches.length === 1){
        isDragging = true;
        previousX = e.touches[0].clientX;
        previousY = e.touches[0].clientY;
    }

    if(e.touches.length === 2){
        startDistance = getDistance(e.touches);
    }
});

document.addEventListener("touchmove", e=>{

    if(!container) return;

    if(isDragging && e.touches.length === 1){

        let deltaX = e.touches[0].clientX - previousX;
        let deltaY = e.touches[0].clientY - previousY;

        let rotation = container.getAttribute("rotation");

        rotation.y += deltaX * 0.5;
        rotation.x += deltaY * 0.5;

        container.setAttribute("rotation", rotation);

        previousX = e.touches[0].clientX;
        previousY = e.touches[0].clientY;
    }

    if(e.touches.length === 2){

        let newDistance = getDistance(e.touches);

        if(startDistance){

            let diff = newDistance - startDistance;

            scale += diff * 0.005;
            scale = Math.min(Math.max(scale, 0.5), 3);

            container.setAttribute("scale",
                `${scale} ${scale} ${scale}`);
        }

        startDistance = newDistance;
    }

});

document.addEventListener("touchend", ()=>{
    isDragging = false;
    startDistance = null;
});

});

</script>

</body>
</html>
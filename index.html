<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AR Eye Voice</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

<style>
body{ margin:0; overflow:hidden; }

#info{
    position:absolute;
    bottom:20px;
    width:100%;
    text-align:center;
    color:white;
    background:rgba(0,0,0,0.6);
    padding:10px;
    font-family:Arial;
}
</style>
</head>

<body>

<div id="info">
ðŸ‘‰ Tap screen to place the Eye
</div>

<a-scene
xr-mode-ui="enabled: true"
renderer="logarithmicDepthBuffer:true;"
webxr="requiredFeatures: hit-test"
>

<a-assets>
<a-asset-item id="eyeModel" src="models/eye.glb"></a-asset-item>
</a-assets>

<a-camera id="camera" position="0 1.6 0"></a-camera>

<a-entity id="modelContainer"
          scale="0.5 0.5 0.5"
          visible="false">

    <a-entity gltf-model="#eyeModel"></a-entity>

</a-entity>

</a-scene>

<script>

const scene = document.querySelector("a-scene");
const container = document.getElementById("modelContainer");
const camera = document.getElementById("camera");

let xrSession = null;
let hitTestSource = null;
let placed = false;


// ================= VOICE =================

function speakEyeInfo(){

    const englishText =
    "The human eye is an important sensory organ. It helps us to see light, colors, shapes, and movement.";

    const kannadaText =
    "à²®à²¾à²¨à²µ à²•à²£à³à²£à³ à²’à²‚à²¦à³ à²ªà³à²°à²®à³à²– à²‡à²‚à²¦à³à²°à²¿à²¯ à²…à²‚à²—à²µà²¾à²—à²¿à²¦à³†. à²‡à²¦à³ à²¬à³†à²³à²•à³, à²¬à²£à³à²£à²—à²³à³ à²®à²¤à³à²¤à³ à²†à²•à²¾à²°à²—à²³à²¨à³à²¨à³ à²¨à³‹à²¡à²²à³ à²¸à²¹à²¾à²¯ à²®à²¾à²¡à³à²¤à³à²¤à²¦à³†.";

    const english = new SpeechSynthesisUtterance(englishText);
    english.lang = "en-US";

    const kannada = new SpeechSynthesisUtterance(kannadaText);
    kannada.lang = "kn-IN";

    english.onend = () => {
        speechSynthesis.speak(kannada);
    };

    speechSynthesis.speak(english);
}


// ================= AR HIT TEST =================

scene.addEventListener("enter-vr", async () => {

    xrSession = scene.renderer.xr.getSession();

    const viewerSpace = await xrSession.requestReferenceSpace("viewer");
    hitTestSource = await xrSession.requestHitTestSource({
        space: viewerSpace
    });

});


scene.renderer.xr.addEventListener("sessionend", () => {
    hitTestSource = null;
});


// ================= TAP TO PLACE =================

scene.addEventListener("click", () => {

    if (placed) return;

    const xrFrame = scene.frame;

    if (!xrFrame || !hitTestSource) return;

    const referenceSpace =
        scene.renderer.xr.getReferenceSpace();

    const hitTestResults =
        xrFrame.getHitTestResults(hitTestSource);

    if (hitTestResults.length > 0) {

        const hit = hitTestResults[0];
        const pose = hit.getPose(referenceSpace);

        const pos = pose.transform.position;

        container.setAttribute("position",
            `${pos.x} ${pos.y} ${pos.z}`);

        container.setAttribute("visible", true);

        speakEyeInfo();

        placed = true;
    }

});

</script>

</body>
</html>
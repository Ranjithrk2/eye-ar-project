<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Human Eye AR Voice</title>

<!-- AFRAME -->
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

<!-- ARJS -->
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>

<style>
body{
    margin:0;
    overflow:hidden;
    font-family: Arial;
}

#info{
    position:absolute;
    bottom:20px;
    width:100%;
    text-align:center;
    color:white;
    background:rgba(0,0,0,0.6);
    padding:10px;
}

#voiceBtn{
    position:absolute;
    bottom:80px;
    left:50%;
    transform:translateX(-50%);
    padding:10px 20px;
    font-size:16px;
    border:none;
    border-radius:8px;
    background:#00aaff;
    color:white;
}
</style>
</head>

<body>

<div id="info">
ðŸ“± Point camera at HIRO marker
</div>

<button id="voiceBtn" onclick="speakEyeInfo()">
ðŸ”Š Hear Explanation
</button>

<a-scene
embedded
vr-mode-ui="enabled:false"
renderer="logarithmicDepthBuffer:true;"
arjs="sourceType: webcam; debugUIEnabled: false;"
>

<a-assets>
    <!-- YOUR MODEL PATH -->
    <a-asset-item id="eyeModel" src="models/eye.glb"></a-asset-item>
</a-assets>

<a-marker preset="hiro" id="marker">

    <!-- MODEL CONTAINER -->
    <a-entity id="modelContainer"
              scale="1 1 1"
              rotation="0 0 0">

        <a-entity
            id="eye"
            gltf-model="#eyeModel"
            position="0 0 0"
            rotation="0 0 0">
        </a-entity>

    </a-entity>

</a-marker>

<a-entity camera></a-entity>

</a-scene>

<script>

// ================= VOICE =================

function speakEyeInfo() {

    const text = `
    This is the human eye.
    The eye is a sensory organ that helps us to see.

    The cornea is the transparent front layer that focuses light.
    The iris controls the amount of light entering the eye.
    The retina converts light into signals sent to the brain.

    Together, these parts allow us to see clearly.
    `;

    const speech = new SpeechSynthesisUtterance(text);

    speech.rate = 0.9;
    speech.pitch = 1;
    speech.volume = 1;
    speech.lang = "en-US";

    window.speechSynthesis.cancel(); 
    window.speechSynthesis.speak(speech);
}

// Play voice when marker detected
const marker = document.querySelector("#marker");

marker.addEventListener("markerFound", () => {
    speakEyeInfo();
});


// ================= TOUCH CONTROLS =================

window.addEventListener("load", () => {

const container = document.getElementById("modelContainer");

let isDragging = false;
let previousX = 0;
let previousY = 0;
let scale = 1;
let startDistance = null;

function getDistance(touches){
    let dx = touches[0].clientX - touches[1].clientX;
    let dy = touches[0].clientY - touches[1].clientY;
    return Math.sqrt(dx*dx + dy*dy);
}

// TOUCH START
document.addEventListener("touchstart", e=>{

    if(e.touches.length === 1){
        isDragging = true;
        previousX = e.touches[0].clientX;
        previousY = e.touches[0].clientY;
    }

    if(e.touches.length === 2){
        startDistance = getDistance(e.touches);
    }

});

// TOUCH MOVE
document.addEventListener("touchmove", e=>{

    if(!container) return;

    // ROTATE
    if(isDragging && e.touches.length === 1){

        let deltaX = e.touches[0].clientX - previousX;
        let deltaY = e.touches[0].clientY - previousY;

        let rotation = container.getAttribute("rotation");

        rotation.y += deltaX * 0.5;
        rotation.x += deltaY * 0.5;

        container.setAttribute("rotation", rotation);

        previousX = e.touches[0].clientX;
        previousY = e.touches[0].clientY;
    }

    // ZOOM
    if(e.touches.length === 2){

        let newDistance = getDistance(e.touches);

        if(startDistance){

            let diff = newDistance - startDistance;

            scale += diff * 0.005;
            scale = Math.min(Math.max(scale, 0.5), 3);

            container.setAttribute("scale",
                `${scale} ${scale} ${scale}`);
        }

        startDistance = newDistance;
    }

});

// TOUCH END
document.addEventListener("touchend", ()=>{
    isDragging = false;
    startDistance = null;
});

});

</script>

</body>
</html>